
type TTest = record str: string; x,y: Int32; end;
type TTestArray = array of record lol: Int32; data:string; end;


func main();
  var a: TTestArray;
  var b: TTestArray;
  a.setlen(1000);
  var h := a.High();
  for(var j:=0; j <= h; j+=1)
    a[j].data := 'hello' + ' bar'

  b := a;
end;


for(var i:=0; i < 100; i+=1)
  main()


var b: TTestArray;
b.Setlen(10000);
b[100].data := 'foo'+'bar'
b[66].data := nil

var t: array of char;
t.setlen(1000000);

print t._refcnt();


func PassArray(a: array of int)
  print a._refcnt()
end;

func ReturnArray(): array of int
  Result.setlen(1000000);
  print Result._refcnt()
end;


var a: array of int;
a.setlen(10000000);
print a._refcnt()
PassArray(a)
print a._refcnt()
a := nil;

var a := returnArray()
print a._refcnt()




